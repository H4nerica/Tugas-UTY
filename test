#include <WiFi.h>
#include <HTTPClient.h>

// Konfigurasi WiFi
const char* ssid = "wi-fi";  // Ganti dengan SSID WiFi Anda
const char* password = "password"; // Ganti dengan password WiFi Anda

// Konfigurasi server
const char* serverName = "http://192.168.137.7/praktek/insert.php"; // Ganti dengan URL PHP

// ID alat (misalnya unik untuk setiap ESP32)
const int id_alat = 1;

void setup() {
    Serial.begin(115200);
    WiFi.begin(ssid, password);

    Serial.print("Menghubungkan ke WiFi");
    while (WiFi.status() != WL_CONNECTED) {
        delay(1000);
        Serial.print(".");
    }
    Serial.println("\nTerhubung ke WiFi!");
}

void loop() {
    if (WiFi.status() == WL_CONNECTED) {
        HTTPClient http;

        // Generate nilai acak untuk suhu dan kelembaban
        float temperature = random(200, 350) / 10.0; // Nilai antara 20.0 - 35.0
        float humidity = random(400, 800) / 10.0; // Nilai antara 40.0 - 80.0

        String postData = "id_alat=" + String(id_alat) +
                          "&temperature=" + String(temperature) +
                          "&humidity=" + String(humidity);

        Serial.println("Mengirim data: " + postData);

        http.begin(serverName);
        http.addHeader("Content-Type", "application/x-www-form-urlencoded");

        int httpResponseCode = http.POST(postData);

        if (httpResponseCode > 0) {
            String response = http.getString();
            Serial.println("Respon Server: " + response);
        } else {
            Serial.print("Error mengirim data: ");
            Serial.println(httpResponseCode);
        }

        http.end();
    } else {
        Serial.println("WiFi tidak terhubung");
    }

    delay(10000); // Kirim data setiap 60 detik
}